<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Ronnie Ruchal – OT Tracker</title>

<style>
body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:#f2f2f2;margin:0}
.container{max-width:420px;margin:auto;padding:15px}
h2{text-align:center}
select,input,button{width:100%;padding:10px;margin:6px 0;font-size:16px}
button{background:#111;color:#fff;border:none;border-radius:6px}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:14px}
th,td{border-bottom:1px solid #ccc;padding:6px;text-align:center}
.red{color:#c00;font-weight:600}
.hide{display:none}
.small{font-size:12px;color:#555}
</style>
</head>

<body>
<div class="container">
<h2>Ronnie Ruchal – OT Tracker</h2>

<!-- Salary -->
<div id="salaryBox">
<input type="number" id="rateInput" placeholder="Hourly rate ₩">
<button onclick="saveRate()">Save Rate</button>
</div>

<div id="rateSaved" class="hide small">
Hourly Rate: ₩<span id="rateText"></span>
<button onclick="changeRate()">Change Rate</button>
</div>

<hr>

<!-- Entry -->
<select id="dayType" onchange="updateUI()">
<option value="weekday">Weekday</option>
<option value="saturday">Saturday</option>
<option value="sunday">Sunday</option>
<option value="holiday">Public Holiday</option>
</select>

<select id="dateOffset">
<option value="0">Today</option>
<option value="1">1 day ago</option>
<option value="2">2 days ago</option>
<option value="3">3 days ago</option>
</select>

<div id="workedBox" class="hide">
<select id="worked">
<option value="yes">Worked</option>
<option value="no">Did not work</option>
</select>
</div>

<select id="outTime"></select>

<button onclick="saveEntry()">Save</button>

<!-- History -->
<table>
<thead>
<tr><th>Date</th><th>Day</th><th>Hours</th><th>X</th></tr>
</thead>
<tbody id="history"></tbody>
</table>

<hr>
<button onclick="showReport()">Monthly Report</button>
<div id="report" class="small"></div>
</div>

<script>
/* ---------- DATA ---------- */
let data = JSON.parse(localStorage.getItem("otData") || "[]");
let rate = localStorage.getItem("rate");

/* ---------- TIME OPTIONS ---------- */
const weekdayTimes = ["5:30","6:00","6:30","7:00","7:30","8:00","8:30","9:00","9:30","10:00","10:30","11:00","11:30","12:00"];
const holidayTimes = ["5:30","6:00","6:30","7:00","7:30","8:00","8:30","9:00"];

function toMin(t){
  let p=t.split(":");
  return (+p[0])*60+(+p[1]);
}

/* ---------- SALARY UI ---------- */
function applySalaryUI(){
  if(rate){
    document.getElementById("salaryBox").classList.add("hide");
    document.getElementById("rateSaved").classList.remove("hide");
    document.getElementById("rateText").innerText = rate;
  }else{
    document.getElementById("salaryBox").classList.remove("hide");
    document.getElementById("rateSaved").classList.add("hide");
  }
}

function saveRate(){
  let v=document.getElementById("rateInput").value;
  if(!v) return alert("Enter hourly rate");
  rate=v;
  localStorage.setItem("rate",rate);
  applySalaryUI();
}

function changeRate(){
  rate=null;
  localStorage.removeItem("rate");
  applySalaryUI();
}

/* ---------- UI UPDATE ---------- */
function updateUI(){
  let day=document.getElementById("dayType").value;
  let out=document.getElementById("outTime");
  let workedBox=document.getElementById("workedBox");
  out.innerHTML="";

  let arr = (day==="weekday") ? weekdayTimes : holidayTimes;
  arr.forEach(t=>{
    let o=document.createElement("option");
    o.value=t;o.text=t;
    out.appendChild(o);
  });

  if(day==="weekday"){
    workedBox.classList.add("hide");
  }else{
    workedBox.classList.remove("hide");
  }
}

/* ---------- SAVE ENTRY ---------- */
function saveEntry(){
  let day=document.getElementById("dayType").value;
  let off=+document.getElementById("dateOffset").value;
  let date=new Date(); date.setDate(date.getDate()-off);
  let key=date.toDateString();

  if(data.find(e=>e.key===key)){
    alert("Already saved for this date");
    return;
  }

  let worked="yes";
  if(day!=="weekday") worked=document.getElementById("worked").value;

  let out=document.getElementById("outTime").value;
  let hours=0;

  if(day==="weekday"){
    hours=Math.max(0,(toMin(out)-toMin("5:30"))/60);
  }else{
    if(worked==="yes"){
      hours=8+Math.max(0,(toMin(out)-toMin("5:30"))/60);
    }
  }

  data.push({key,day,worked,out,hours});
  localStorage.setItem("otData",JSON.stringify(data));
  render();
}

/* ---------- RENDER ---------- */
function render(){
  let h=document.getElementById("history");
  h.innerHTML="";
  data.forEach((e,i)=>{
    let tr=document.createElement("tr");
    if(e.day!=="weekday") tr.classList.add("red");
    tr.innerHTML=`
      <td>${e.key}</td>
      <td>${e.day}</td>
      <td>${e.hours}</td>
      <td><button onclick="del(${i})">X</button></td>`;
    h.appendChild(tr);
  });
}

function del(i){
  data.splice(i,1);
  localStorage.setItem("otData",JSON.stringify(data));
  render();
}

/* ---------- REPORT ---------- */
function showReport(){
  let wd=0,sa=0,su=0,ho=0;
  data.forEach(e=>{
    if(e.day==="weekday") wd+=e.hours;
    if(e.day==="saturday"&&e.worked==="yes") sa++;
    if(e.day==="sunday"&&e.worked==="yes") su++;
    if(e.day==="holiday"&&e.worked==="yes") ho++;
  });
  document.getElementById("report").innerHTML=
    `Weekday OT hours: ${wd}<br>
     Saturday worked days: ${sa}<br>
     Sunday worked days: ${su}<br>
     Public holiday worked days: ${ho}`;
}

/* ---------- INIT ---------- */
applySalaryUI();
updateUI();
render();
</script>
</body>
</html>
