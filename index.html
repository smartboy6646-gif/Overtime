<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Ronnie Payroll Pro v2.9</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
:root { --primary: #2962ff; --bg: #f0f4f8; --card-bg: #ffffff; --text: #333; --red: #d32f2f; --green: #4caf50; --dark: #0a192f; }
body{margin:0;font-family:sans-serif;background:var(--bg);color:var(--text);}
.container{max-width:420px;margin:auto;padding:12px;}
h2{text-align:center;color:var(--primary); margin-bottom: 15px;}
.card{background:var(--card-bg);padding:16px;border-radius:16px;margin-bottom:12px;box-shadow:0 4px 10px rgba(0,0,0,0.1);}
label{font-size:11px;color:var(--primary);font-weight:bold;display:block;margin-bottom:4px;text-transform:uppercase;}
select, input{width:100%; height:45px; border-radius:10px; border:1px solid #ccc; margin-bottom:10px; padding:0 10px; box-sizing:border-box; font-size:16px;}
.btn-save{width:100%; height:50px; background:var(--primary); color:#fff; border:none; border-radius:12px; font-weight:bold; cursor:pointer;}
table{width:100%; border-collapse:collapse; font-size:13px; margin-top:10px;}
th{border-bottom:1px solid #eee; padding:8px; color:#666; text-align: center;}
td{padding:10px; text-align:center; border-bottom:1px solid #f5f5f5;}
.report-card{background:var(--dark); color:#fff; padding:20px; border-radius:16px; display:none; margin-top: 10px;} 
.report-line{display:flex; justify-content:space-between; margin-bottom:8px; border-bottom:1px solid #1e2d4d; padding-bottom:4px;}
.report-val{color:var(--green); font-weight:bold;}
.salary-box{background:#112240; padding:15px; border-radius:12px; text-align:center; border:1px solid var(--green); margin-top:10px;}
.total-amt{font-size:28px; color:var(--green); font-weight:bold;}
.red-btn{background:var(--red); color:#fff; width:100%; height:45px; border:none; border-radius:12px; margin-top:10px; cursor:pointer; font-weight: bold;}
.photo-btn{background:var(--green); color:#fff; width:100%; height:48px; border:none; border-radius:12px; margin-top:10px; cursor:pointer; font-weight: bold;}
.exporting .del-col { display: none; }
</style>
</head>
<body>

<div class="container">
    <h2>Ronnie Payroll Pro</h2>
    
    <div class="card">
        <label>Date & Day Type</label>
        <input type="date" id="inputDate" onchange="autoDetectDay()">
        <select id="dayType" onchange="updateUI()">
            <option value="weekday">Weekday</option>
            <option value="saturday">Saturday</option>
            <option value="sunday">Sunday</option>
            <option value="holiday">Holiday</option>
        </select>
        
        <div id="workedBox" style="display:none;">
            <label>Worked Today?</label>
            <select id="worked" onchange="updateUI()">
                <option value="yes">Yes</option>
                <option value="no">No</option>
            </select>
        </div>
        
        <div id="outBox">
            <label>Out Time</label>
            <select id="outTime"></select>
        </div>
        <button class="btn-save" onclick="saveEntry()">Save Entry üíæ</button>
    </div>

    <div id="exportArea">
        <div class="card">
            <label>Attendance History</label>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Basic</th>
                        <th>OT</th>
                        <th class="del-col">Del</th>
                    </tr>
                </thead>
                <tbody id="historyBody"></tbody>
            </table>
        </div>

        <div class="report-card" id="salaryReport">
            <div style="text-align:center; color:var(--green); margin-bottom:10px; font-weight:bold;">Monthly Summary</div>
            <div class="report-line"><span>Weekday Basic:</span><span class="report-val" id="dispBasic">0</span></div>
            <div class="report-line"><span>Weekday OT:</span><span class="report-val" id="dispNormalOt">0</span></div>
            <div class="report-line"><span>Saturday Pay:</span><span class="report-val" id="dispSat">0</span></div>
            <div class="report-line"><span>Sunday Pay:</span><span class="report-val" id="dispSun">0</span></div>
            <div class="report-line"><span>Holiday Pay:</span><span class="report-val" id="dispHol">0</span></div>
            <div class="report-line"><span>Night Bonus:</span><span class="report-val" id="dispNight">0</span></div>
            <div class="salary-box">
                <div style="font-size:12px; color:#aaa;">Estimated Total Salary</div>
                <div class="total-amt">‚Ç© <span id="finalSalary">0</span></div>
            </div>
        </div>
    </div>

    <div class="card">
        <label>Hourly Rate (‚Ç©)</label>
        <input type="number" id="hourlyRate" value="9860">
        <button class="photo-btn" onclick="calculateAndShow()">Calculate Salary & Show ‚Ç©</button>
        <button class="photo-btn" style="background:#607d8b;" onclick="downloadPhoto()">Download Report üì∏</button>
        <button class="red-btn" onclick="resetAll()">Reset Month (Clear All Data)</button>
    </div>
</div>

<script>
const STORE_KEY = "ronnie_pro_final_v1";
let entries = JSON.parse(localStorage.getItem(STORE_KEY) || "[]");

const times = ["5:30 PM","6:00 PM","6:30 PM","7:00 PM","7:30 PM","8:00 PM","8:30 PM","9:00 PM","9:30 PM","10:00 PM","10:30 PM","11:00 PM","11:30 PM","12:00 AM"];

function autoDetectDay() {
    let d = new Date(document.getElementById("inputDate").value);
    if (isNaN(d.getTime())) return;
    let day = d.getDay();
    let select = document.getElementById("dayType");
    if(day === 0) select.value = "sunday";
    else if(day === 6) select.value = "saturday";
    else select.value = "weekday";
    updateUI();
}

function updateUI() {
    let type = document.getElementById("dayType").value;
    let out = document.getElementById("outTime");
    out.innerHTML = "";
    times.forEach(t => { let opt = new Option(t, t); out.add(opt); });
    document.getElementById("workedBox").style.display = (type === "weekday") ? "none" : "block";
}

function timeToMins(t) {
    let [time, mod] = t.split(' ');
    let [h, m] = time.split(':').map(Number);
    if (h === 12) h = (mod === 'AM') ? 0 : 12;
    else if (mod === 'PM') h += 12;
    return (h * 60) + m;
}

function saveEntry() {
    let date = document.getElementById("inputDate").value;
    if(!date) return alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§Æ‡§ø‡§§‡§ø ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!");
    if(entries.find(e => e.date === date)) return alert("‡§Ø‡•ã ‡§Æ‡§ø‡§§‡§ø‡§ï‡•ã ‡§°‡•á‡§ü‡§æ ‡§™‡§π‡§ø‡§≤‡•á ‡§®‡•à ‡§õ!");
    
    let type = document.getElementById("dayType").value;
    let outVal = document.getElementById("outTime").value;
    let worked = (type === "weekday") ? "yes" : document.getElementById("worked").value;
    
    let normalOt = 0, nightOt = 0, basicHrs = 0;
    if(worked === "yes") {
        basicHrs = 8;
        let mins = timeToMins(outVal);
        normalOt = Math.max(0, (Math.min(mins, 1320) - 1050) / 60);
        nightOt = Math.max(0, (mins - 1320) / 60);
    }

    entries.push({ date, type, worked, normalOt, nightOt, basicHrs });
    localStorage.setItem(STORE_KEY, JSON.stringify(entries));
    renderHistory();
    // ‡§®‡§Ø‡§æ‡§Å ‡§á‡§®‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§•‡§™‡•á‡§™‡§õ‡§ø ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§≤‡•Å‡§ï‡§æ‡§â‡§®‡•á (‡§™‡•Å‡§®‡§É ‡§ï‡•ç‡§Ø‡§æ‡§≤‡§ï‡•Å‡§≤‡•á‡§ü ‡§ó‡§∞‡•ç‡§®‡•Å‡§™‡§∞‡•ç‡§®‡•á ‡§∏‡§®‡•ç‡§¶‡•á‡§∂‡§ï‡•ã ‡§∞‡•Ç‡§™‡§Æ‡§æ)
    document.getElementById("salaryReport").style.display = "none";
}

function renderHistory() {
    let body = document.getElementById("historyBody");
    body.innerHTML = "";
    
    // ‡§Æ‡§ø‡§§‡§ø ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§Æ‡§ø‡§≤‡§æ‡§â‡§®‡•á
    entries.sort((a,b) => new Date(a.date) - new Date(b.date));
    
    entries.forEach((e, i) => {
        let row = document.createElement("tr");
        row.innerHTML = `
            <td>${e.date.split('-')[2]}</td>
            <td style="text-transform:capitalize">${e.type.slice(0,3)}</td>
            <td>${e.basicHrs}</td>
            <td>${(e.normalOt + e.nightOt).toFixed(1)}</td>
            <td class="del-col"><button onclick="delEntry(${i})" style="color:red; border:none; background:none; font-size: 18px; cursor:pointer;">‚úï</button></td>
        `;
        body.appendChild(row);
    });
}

function calculateAndShow() {
    if(entries.length === 0) return alert("‡§π‡§ø‡§∏‡§æ‡§¨ ‡§ó‡§∞‡•ç‡§®‡§ï‡•ã ‡§≤‡§æ‡§ó‡§ø ‡§™‡§π‡§ø‡§≤‡•á ‡§°‡•á‡§ü‡§æ ‡§π‡§æ‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!");
    
    let rate = parseFloat(document.getElementById("hourlyRate").value) || 0;
    let vBasic = 0, vNormalOt = 0, vSat = 0, vSun = 0, vHol = 0, vNight = 0;

    entries.forEach(e => {
        if(e.type === "weekday") {
            vBasic += e.basicHrs * rate;
            vNormalOt += e.normalOt * rate * 1.5;
        } else if(e.worked === "yes") {
            // Weekend/Holiday: Basic 8hr (1.5x) + Extra OT (2.0x total rate effectively)
            let basePay = (e.basicHrs * rate * 1.5);
            let extraOtPay = ((e.normalOt + e.nightOt) * rate * 0.5); 
            let totalDay = basePay + extraOtPay;
            
            if(e.type === "saturday") vSat += totalDay;
            else if(e.type === "sunday") vSun += totalDay;
            else if(e.type === "holiday") vHol += totalDay;
        }
        // Night Bonus (10PM - 12AM) is always 0.5 extra in Korea on top of OT
        vNight += e.nightOt * rate * 0.5; 
    });

    document.getElementById("dispBasic").innerText = "‚Ç© " + Math.round(vBasic).toLocaleString();
    document.getElementById("dispNormalOt").innerText = "‚Ç© " + Math.round(vNormalOt).toLocaleString();
    document.getElementById("dispSat").innerText = "‚Ç© " + Math.round(vSat).toLocaleString();
    document.getElementById("dispSun").innerText = "‚Ç© " + Math.round(vSun).toLocaleString();
    document.getElementById("dispHol").innerText = "‚Ç© " + Math.round(vHol).toLocaleString();
    document.getElementById("dispNight").innerText = "‚Ç© " + Math.round(vNight).toLocaleString();
    
    let total = vBasic + vNormalOt + vSat + vSun + vHol + vNight;
    document.getElementById("finalSalary").innerText = Math.round(total).toLocaleString();
    
    // ‡§Ö‡§¨ ‡§Æ‡§æ‡§§‡•ç‡§∞ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§æ‡§∞‡•ç‡§° ‡§¶‡•á‡§ñ‡§æ‡§â‡§®‡•á
    document.getElementById("salaryReport").style.display = "block";
}

function delEntry(index) {
    if(confirm("‡§ï‡•á ‡§§‡§™‡§æ‡§à‡§Ç ‡§Ø‡•ã ‡§¶‡§ø‡§®‡§ï‡•ã ‡§∞‡•á‡§ï‡§∞‡•ç‡§° ‡§π‡§ü‡§æ‡§â‡§® ‡§ö‡§æ‡§π‡§®‡•Å‡§π‡•Å‡§®‡•ç‡§õ?")) {
        entries.splice(index, 1); // ‡§è‡§∞‡•á‡§¨‡§æ‡§ü ‡§π‡§ü‡§æ‡§â‡§®‡•á
        localStorage.setItem(STORE_KEY, JSON.stringify(entries)); // ‡§∏‡•á‡§≠ ‡§ó‡§∞‡•ç‡§®‡•á
        renderHistory(); // ‡§ü‡•á‡§¨‡§≤ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ó‡§∞‡•ç‡§®‡•á
        document.getElementById("salaryReport").style.display = "none"; // ‡§π‡§ø‡§∏‡§æ‡§¨ ‡§≤‡•Å‡§ï‡§æ‡§â‡§®‡•á
    }
}

function resetAll() {
    if(confirm("‡§∏‡§æ‡§µ‡§ß‡§æ‡§®! ‡§ï‡•á ‡§§‡§™‡§æ‡§à‡§Ç ‡§Ø‡•ã ‡§Æ‡§π‡§ø‡§®‡§æ‡§ï‡•ã ‡§∏‡§¨‡•à ‡§°‡•á‡§ü‡§æ ‡§°‡§ø‡§≤‡§ø‡§ü ‡§ó‡§∞‡•ç‡§® ‡§ö‡§æ‡§π‡§®‡•Å‡§π‡•Å‡§®‡•ç‡§õ? ‡§Ø‡•ã ‡§´‡§ø‡§∞‡•ç‡§§‡§æ ‡§Ü‡§â‡§®‡•á ‡§õ‡•à‡§®‡•§")) {
        entries = [];
        localStorage.setItem(STORE_KEY, JSON.stringify(entries));
        renderHistory();
        document.getElementById("salaryReport").style.display = "none";
        alert("‡§∏‡§¨‡•à ‡§°‡•á‡§ü‡§æ ‡§∏‡§´‡§æ ‡§ó‡§∞‡§ø‡§Ø‡•ã‡•§");
    }
}

function downloadPhoto() {
    const area = document.getElementById('exportArea');
    area.classList.add('exporting');
    html2canvas(area).then(canvas => {
        const link = document.createElement('a');
        link.download = `Payroll_${new Date().toLocaleDateString()}.png`;
        link.href = canvas.toDataURL();
        link.click();
        area.classList.remove('exporting');
    });
}

// ‡§∏‡•Å‡§∞‡•Å‡§Æ‡§æ ‡§¶‡•á‡§ñ‡§æ‡§â‡§®‡§ï‡•ã ‡§≤‡§æ‡§ó‡§ø
document.getElementById('inputDate').value = new Date().toISOString().split('T')[0];
updateUI();
renderHistory();
</script>

</body>
</html>
