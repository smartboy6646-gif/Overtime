<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Ronnie Ruchal – OT Tracker</title>

<style>
:root{
  --blue:#1e88e5;
  --blue-dark:#1565c0;
  --bg:#eef4fb;
}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:var(--bg);
}
.container{
  max-width:420px;
  margin:auto;
  padding:14px;
}
.card{
  background:#fff;
  border-radius:12px;
  padding:14px;
  margin-bottom:12px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}
h2{
  text-align:center;
  color:var(--blue-dark);
  margin:8px 0 14px;
}
label{
  font-size:13px;
  color:#444;
}
select,input,button{
  width:100%;
  padding:11px;
  margin-top:6px;
  font-size:16px;
  border-radius:8px;
  border:1px solid #cfd8dc;
}
button{
  background:var(--blue);
  color:#fff;
  border:none;
}
button:active{background:var(--blue-dark)}
.hide{display:none}
.small{font-size:12px;color:#555}

table{
  width:100%;
  border-collapse:collapse;
  font-size:14px;
}
th,td{
  padding:8px 4px;
  border-bottom:1px solid #e0e0e0;
  text-align:center;
}
.red{color:#d32f2f;font-weight:600}
</style>
</head>

<body>
<div class="container">
<h2>OT & Salary Tracker</h2>

<!-- SALARY -->
<div class="card" id="salaryBox">
<label>Hourly Rate (₩)</label>
<input type="number" id="rateInput" placeholder="Enter hourly rate">
<button onclick="saveRate()">Save Rate</button>
</div>

<div class="card hide" id="rateSaved">
<div class="small">Hourly Rate</div>
<b>₩ <span id="rateText"></span></b>
<button style="margin-top:8px" onclick="changeRate()">Change Rate</button>
</div>

<!-- ENTRY -->
<div class="card">
<label>Day Type</label>
<select id="dayType" onchange="updateUI()">
  <option value="weekday">Weekday</option>
  <option value="saturday">Saturday</option>
  <option value="sunday">Sunday</option>
  <option value="holiday">Public Holiday</option>
</select>

<label>Date</label>
<select id="dateOffset">
  <option value="0">Today</option>
  <option value="1">1 day ago</option>
  <option value="2">2 days ago</option>
  <option value="3">3 days ago</option>
</select>

<div id="workedBox" class="hide">
  <label>Worked?</label>
  <select id="worked" onchange="updateUI()">
    <option value="yes">Yes</option>
    <option value="no">No</option>
  </select>
</div>

<div id="outTimeBox">
  <label>Out Time</label>
  <select id="outTime"></select>
</div>

<button onclick="saveEntry()">Save Entry</button>
</div>

<!-- HISTORY -->
<div class="card">
<table>
<thead>
<tr><th>Date</th><th>Day</th><th>Hours</th><th>X</th></tr>
</thead>
<tbody id="history"></tbody>
</table>
</div>

<!-- REPORT -->
<div class="card">
<button onclick="showReport()">Monthly Report</button>
<div id="report" class="small" style="margin-top:8px"></div>
</div>

</div>

<script>
/* ===== DATA ===== */
let data = JSON.parse(localStorage.getItem("otData") || "[]");
let rate = localStorage.getItem("rate");
let rateLocked = localStorage.getItem("rateLocked");

/* ===== TIME OPTIONS ===== */
const weekdayTimes = ["5:30","6:00","6:30","7:00","7:30","8:00","8:30","9:00","9:30","10:00","10:30","11:00","11:30","12:00"];
const holidayTimes = ["5:30","6:00","6:30","7:00","7:30","8:00","8:30","9:00"];

const toMin = t => {
  let p=t.split(":"); return (+p[0])*60+(+p[1]);
};

/* ===== SALARY UI (FIXED) ===== */
function applySalaryUI(){
  if(rate && rateLocked==="yes"){
    document.getElementById("salaryBox").classList.add("hide");
    document.getElementById("rateSaved").classList.remove("hide");
    document.getElementById("rateText").innerText = rate;
  }else{
    document.getElementById("salaryBox").classList.remove("hide");
    document.getElementById("rateSaved").classList.add("hide");
  }
}
function saveRate(){
  const v=document.getElementById("rateInput").value;
  if(!v) return alert("Enter hourly rate");
  rate=v;
  localStorage.setItem("rate",rate);
  localStorage.setItem("rateLocked","yes");
  applySalaryUI();
}
function changeRate(){
  localStorage.removeItem("rateLocked");
  rateLocked=null;
  applySalaryUI();
}

/* ===== UI UPDATE ===== */
function updateUI(){
  const day=document.getElementById("dayType").value;
  const out=document.getElementById("outTime");
  const workedBox=document.getElementById("workedBox");
  const outBox=document.getElementById("outTimeBox");
  const worked=document.getElementById("worked").value;

  out.innerHTML="";
  const arr = (day==="weekday") ? weekdayTimes : holidayTimes;
  arr.forEach(t=>{
    const o=document.createElement("option");
    o.value=t;o.text=t; out.appendChild(o);
  });

  if(day==="weekday"){
    workedBox.classList.add("hide");
    outBox.classList.remove("hide");
  }else{
    workedBox.classList.remove("hide");
    if(worked==="no"){
      outBox.classList.add("hide");
    }else{
      outBox.classList.remove("hide");
    }
  }
}

/* ===== SAVE ENTRY ===== */
function saveEntry(){
  const day=document.getElementById("dayType").value;
  const off=+document.getElementById("dateOffset").value;
  const date=new Date(); date.setDate(date.getDate()-off);
  const key=date.toDateString();

  if(data.find(e=>e.key===key)){
    alert("Already saved for this date"); return;
  }

  let worked="yes";
  if(day!=="weekday") worked=document.getElementById("worked").value;

  let hours=0;
  if(day==="weekday"){
    const out=document.getElementById("outTime").value;
    hours=Math.max(0,(toMin(out)-toMin("5:30"))/60);
  }else{
    if(worked==="yes"){
      const out=document.getElementById("outTime").value;
      hours=8+Math.max(0,(toMin(out)-toMin("5:30"))/60);
    }
  }

  data.push({key,day,worked,hours});
  localStorage.setItem("otData",JSON.stringify(data));
  render();
}

/* ===== RENDER ===== */
function render(){
  const h=document.getElementById("history");
  h.innerHTML="";
  data.forEach((e,i)=>{
    const tr=document.createElement("tr");
    if(e.day!=="weekday") tr.classList.add("red");
    tr.innerHTML=`
      <td>${e.key}</td>
      <td>${e.day}</td>
      <td>${e.hours}</td>
      <td><button onclick="del(${i})">X</button></td>`;
    h.appendChild(tr);
  });
}
function del(i){
  data.splice(i,1);
  localStorage.setItem("otData",JSON.stringify(data));
  render();
}

/* ===== REPORT ===== */
function showReport(){
  let wd=0,sa=0,su=0,ho=0;
  data.forEach(e=>{
    if(e.day==="weekday") wd+=e.hours;
    if(e.day==="saturday"&&e.worked==="yes") sa++;
    if(e.day==="sunday"&&e.worked==="yes") su++;
    if(e.day==="holiday"&&e.worked==="yes") ho++;
  });
  document.getElementById("report").innerHTML=
    `Weekday OT hours: ${wd}<br>
     Saturday worked days: ${sa}<br>
     Sunday worked days: ${su}<br>
     Public holiday worked days: ${ho}`;
}

/* ===== INIT ===== */
applySalaryUI();
updateUI();
render();
</script>
</body>
</html>
